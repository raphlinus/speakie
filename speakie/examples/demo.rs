use speakie::{BitStream, Speakie};

fn main() {
    let spec = hound::WavSpec {
        channels: 1,
        sample_rate: 8000,
        bits_per_sample: 16,
        sample_format: hound::SampleFormat::Int,
    };
    let mut writer = hound::WavWriter::create("speech.wav", spec).unwrap();
    let lpc_encoded =
[0, 0, 0, 0, 0, 0, 0, 0, 164, 137, 92, 84, 211, 107, 181, 188, 25, 83, 178, 172, 179, 226, 66, 205, 98, 106, 224, 137, 179, 50, 174, 203, 194, 39, 110, 201, 72, 163, 231, 156, 168, 167, 66, 242, 90, 90, 226, 166, 29, 53, 187, 118, 136, 135, 116, 146, 232, 37, 12, 152, 82, 153, 1, 211, 154, 52, 181, 72, 51, 203, 45, 115, 180, 98, 76, 172, 167, 238, 48, 171, 113, 150, 216, 42, 193, 109, 220, 152, 117, 42, 27, 111, 18, 21, 209, 92, 100, 156, 74, 157, 217, 187, 201, 208, 155, 49, 97, 187, 202, 71, 107, 218, 84, 99, 171, 54, 189, 6, 101, 173, 171, 34, 238, 168, 69, 188, 91, 14, 26, 179, 21, 182, 106, 59, 2, 152, 62, 141, 1, 59, 77, 49, 160, 26, 150, 147, 181, 20, 108, 90, 117, 206, 219, 124, 114, 100, 207, 58, 67, 13, 33, 158, 61, 123, 12, 53, 132, 120, 86, 169, 52, 215, 104, 226, 209, 33, 213, 82, 179, 178, 120, 91, 18, 91, 151, 42, 66, 158, 24, 1, 91, 169, 2, 0, 24, 160, 187, 20, 64, 82, 51, 33, 18, 217, 132, 1, 186, 69, 180, 172, 200, 48, 27, 159, 149, 138, 164, 194, 188, 108, 150, 170, 155, 100, 87, 143, 184, 8, 80, 220, 130, 109, 213, 154, 90, 198, 98, 0, 128, 150, 151, 96, 234, 181, 177, 79, 153, 84, 149, 199, 213, 57, 101, 18, 211, 166, 87, 181, 20, 54, 94, 72, 165, 157, 148, 59, 115, 141, 158, 113, 75, 86, 80, 156, 112, 84, 13, 105, 129, 118, 206, 86, 6, 101, 1, 215, 178, 69, 92, 0, 183, 246, 154, 33, 170, 78, 221, 51, 215, 132, 152, 40, 33, 64, 55, 164, 9, 152, 94, 168, 0, 211, 10, 46, 97, 72, 34, 191, 190, 115, 178, 161, 136, 98, 123, 206, 202, 103, 18, 148, 156, 41, 33, 239, 134, 209, 170, 23, 35, 96, 26, 67, 0, 4, 28, 63, 142, 128, 157, 183, 8, 64, 85, 116, 170, 167, 96, 242, 155, 66, 166, 237, 152, 165, 47, 3, 169, 190, 66, 177, 61, 51, 45, 250, 138, 89, 238, 50, 16, 27, 10, 37, 251, 105, 67, 108, 40, 28, 253, 167, 13, 179, 161, 42, 226, 232, 77, 4, 128, 128, 235, 218, 1, 0, 32, 20, 93, 27, 177, 249, 218, 212, 14, 75, 24, 211, 149, 93, 223, 37, 225, 108, 151, 86, 67, 151, 40, 219, 83, 152, 141, 85, 128, 111, 175, 97, 178, 52, 137, 90, 61, 161, 1, 1, 187, 88, 42, 96, 207, 233, 0, 172, 62, 45, 128, 117, 166, 17, 48, 75, 24, 32, 32, 9, 242, 208, 245, 232, 74, 158, 141, 84, 91, 181, 136, 120, 214, 17, 93, 98, 226, 17, 86, 71, 117, 133, 179, 123, 88, 29, 0, 181, 181, 88, 164, 158, 73, 212, 210, 234, 134, 170, 37, 35, 64, 9, 33, 173, 206, 218, 93, 51, 38, 183, 46, 43, 107, 179, 156, 157, 134, 44, 172, 195, 244, 150, 90, 162, 140, 50, 243, 155, 108, 139, 202, 66, 195, 90, 67, 56, 71, 242, 68, 241, 38, 106, 239, 65, 141, 60, 71, 171, 119, 100, 117, 182, 24, 13, 232, 30, 221, 13, 211, 74, 3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 60, 0]
    ;
    let mut bs = BitStream::new(&lpc_encoded);
    let mut speakie = Speakie::new();
    while !speakie.process_frame(&mut bs) {
        for _ in 0..200 {
            let sample = speakie.get_sample();
            writer.write_sample(sample * 2).unwrap();
        }
    }
    writer.finalize().unwrap();
}
